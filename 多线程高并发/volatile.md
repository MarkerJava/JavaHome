### 面大厂又被volatile关键字虐了吗？

### 1、volatile是什么

volatile是Java提供的一种轻量级的同步机制，能够保证线程可见性。意思就是当给变量值加volatile之后，就能够保证当一个线程改变这个变量时，另一个线程马上就能看到。

### 2、为什么要用volatile

Java内存模型，线程可以把变量保存在本地内存（比如机器的寄存器）中，而不是直接在主存中进行读写的。这样就会造成一个问题就是当一个线程在主存中修改了一个变量的值的时候，而另一个线程还在傻傻的使用它在寄存器中的变量值的拷贝，这样就会造成数据的一致。

**为了解决上面的问题，这时候使用volatile来声明一个变量，也就是相当告诉JVM这个变量是不稳定的。**

> 总结：volatile关键字的主要作用就是保证变量的可见性、不保证原子性。及防止JVM指令重排序。

### 3、并发编程的原子性、可见性和有序性

*为了能够深入理解volatile，我们得聊并发编程原子性、可见性和有序性相关概念。*

* 原子性：它是拒绝多线程操作，不管是多核还是单核，具有原子性的量，同一时刻只能有一个线程来对它进行操作。
* 可见性：指的是当多个线程访问同一个变量时，如果有一个线程修改了这个变量的值，那么其他的线程能够马上看到修改的值。
* 有序性：程序执行的顺序按照代码的先后顺序执行

### 4、volatile原理

volatile可以保证线程可见性、但无法保证原子性。在JVM底层volatile它是采用“内存屏障”来实现的。使用volatile关键字和没有用volatile关键字时所生成的汇编代码结果会发现，当加入volatile关键字时，会多出一个lock前缀指令，lock前缀指令实际上相当于一个内存屏障。

### 5、volatile和synchronized区别

* volatile是线性同步机制的轻量级实现，volatile只能用于变量。
* synchronized可以修饰方法和代码块。
* 多线程访问volatile关键字不会发生阻塞，而synchronized可能会
* volatile关键字能保证数据的可见性，但不能保证数据原子性。而synchronized两者都能保证。
* volatile多用于解决多线程之间可见性，而synchronized用于多线程之间访问的同步性。

### 